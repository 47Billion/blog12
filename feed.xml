<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title><![CDATA[The obstacle is the path.]]></title>
    <link>http://47billion.com/blog/</link>
    <atom:link href="/blog/feed.xml" rel="self" type="application/rss+xml"/>
    <description><![CDATA[]]></description>
    <pubDate>Thu, 05 Feb 2015 08:32:43 GMT</pubDate>
    <generator>http://zespia.tw/hexo/</generator>
    
    <item>
      <title><![CDATA[Fun with Singleton (Python, Javascript, Java)]]></title>
      <link>http://47billion.com/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/</link>
      <guid>http://47billion.com/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/</guid>
      <pubDate>Thu, 05 Feb 2015 07:49:56 GMT</pubDate>
      <description>
      <![CDATA[<p>They say that Singletons, like global variables, are evil. They hide dependencies; are harder to test and even harder to extend. Singleto]]>
      </description>
      <content:encoded><![CDATA[<p>They say that Singletons, like global variables, are evil. They hide dependencies; are harder to test and even harder to extend. Singletons are lies, and it’s best to keep away from them. But, there are scenarios where you need them. For example, when you want a shared resource like printer spooler or file manager or log manager, you want a single object to handle requests from all the various parts of your application.</p>
<p>In this blog, I am going to explore various ways to make Singletons in languages like Python, Java and Javascript so as to keep it simple, elegant and usable. Let’s talk about</p>
<img class=" img" width="100" height="100" alt="Python" src="/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/python.png"></img>

<p>Python first. I love it, and it’s a really really wonderful language, and in here, there are n different ways to solve a problem. Singletons are no exception. The most natural way to do it is to create a decorator.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, klass)</span>:</span></div><div class="line">        self.klass = klass   <span class="comment"># class which is being decorated</span></div><div class="line">        self.instance = <span class="keyword">None</span>  <span class="comment"># instance of that class</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.instance <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="comment"># new instance is created and stored for future use</span></div><div class="line">            self.instance = self.klass(*args, **kwargs)</div><div class="line">        <span class="keyword">return</span> self.instance</div></pre></td></tr></table></figure>

<p>Now, let’s say you have a Resource class. To make it singleton, you just need to decorate it with ‘@Singleton‘, and you are done.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="decorator">@Singleton</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, klass)</span>:</span></div><div class="line">        self.name = <span class="keyword">None</span></div></pre></td></tr></table></figure>

<p>Cool…eh? There are other – nerdy – ways too. Python uses an internal dictionary ‘<strong>dict</strong>’ variable to keep track of an Object’s properties and methods. So, if you can share ‘<strong>dict</strong>‘ across multiple instances of a Class, you can share the state between them. And isn’t that Singleton? Yes, that is. You might have many many instances, but all of them behave exactly the same.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></div><div class="line">    _shared = {}</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.__dict__ = Singleton._shared</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span><span class="params">(Singleton)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, klass)</span>:</span></div><div class="line">        self.name = <span class="keyword">None</span></div></pre></td></tr></table></figure>

<p>Since ‘self.<strong>dict</strong>‘ now refers to ‘_shared‘ dictionary, all instances of Resource would use the same dictionary and hence they will all have the same behavior. Geeky? Let me show you an even geekier way to do it.</p>
<p>In Python, when you instantiate a class, the interpreter calls ‘<strong>new</strong>‘ method – a class method which returns an instance of the class – and then ‘<strong>init</strong>‘ method – constructor of the class – is called which initializes the object. So, you can hack into ‘<strong>new</strong>‘ and return the single instance whenever it is being called.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></div><div class="line">    _instance = <span class="keyword">None</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></div><div class="line">    <span class="comment"># cls is the Class and the rest are constructor arguments</span></div><div class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="comment"># create an instance and store it</span></div><div class="line">            cls._instance = Object.__new__(cls, *args, **kwargs)</div><div class="line">        <span class="keyword">return</span> cls._instance</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span><span class="params">(Singleton)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, klass)</span>:</span></div><div class="line">        self.name = <span class="keyword">None</span></div></pre></td></tr></table></figure>

<p>Aweomse! Isn’t it? There are other ways that deal with ‘<strong>metaclass</strong>‘ etc. but let’s save them for another day. Let’s use it now:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># get resource r1</span></div><div class="line">r1 = Resource();</div><div class="line"><span class="comment"># get resource r2  (since Resource is singleton, r1 == r2)</span></div><div class="line">r2 = Resource();</div><div class="line"><span class="comment"># to verify, let's set 'name' onto r1</span></div><div class="line">r1.name = <span class="string">"Animesh Kumar"</span></div><div class="line"><span class="keyword">print</span> r1.name</div><div class="line"><span class="comment"># and the same 'name' appears in r2 as well!</span></div><div class="line"><span class="keyword">print</span> r2.name</div></pre></td></tr></table></figure>

<img class=" img" width="100" height="100" alt="Python" src="/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/javascript.png"></img>

<p>Let’s now see how do we do this in Javascript. For the most simple form, just define an Object Literal, and you are done.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> resource = {</div><div class="line">    getName : <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    },</div><div class="line">    setName: <span class="function"><span class="keyword">function</span><span class="params">(name)</span></span>{</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Easy. You have an object which you can now share across your application modules and it just works. For more complex scenarios, like private variables and all, you might have to resort to something like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// self-executable wrapper function</span></div><div class="line"><span class="keyword">var</span> Resource = (<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">    <span class="comment">// Resouce class which is to made 'singleton'</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_Resource</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">var</span> name; <span class="comment">// private variable</span></div><div class="line">        <span class="keyword">this</span>.getName = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">// getter</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">        };</div><div class="line">        <span class="keyword">this</span>.setName= <span class="function"><span class="keyword">function</span><span class="params">(name)</span></span>{ <span class="comment">// setter</span></div><div class="line">            <span class="keyword">this</span>.name = name;</div><div class="line">        };</div><div class="line">        <span class="comment">// do more stuffs</span></div><div class="line">    }</div><div class="line">    <span class="comment">// instance holder</span></div><div class="line">    <span class="keyword">var</span> instance = <span class="keyword">new</span> _Resource();<span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span></div><div class="line">    // return an object with 'getInstance' method</div><div class="line">    return = {</div><div class="line">        getInstance: function(){</div><div class="line">            return instance;</div><div class="line">        }</div><div class="line">   };</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>_Resource (line-04) is your function of interest, and you want to make it singleton. So, you create another function ‘Resource‘ which wraps over _Resource and returns an object with method ‘getInstance‘ which would return the same instance of _Resource every time it will be called.</p>
<p>Let’s try to use it now:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// get resource r1</span></div><div class="line">r1 = Resource.getInstance();</div><div class="line"><span class="comment">// get resource r2  (since Resource is singleton, r1 == r2)</span></div><div class="line">r2 = Resource.getInstance();</div><div class="line"><span class="comment">// to verify, let's set 'name' onto r1</span></div><div class="line">r1.setName(<span class="string">"Animesh Kumar"</span>);</div><div class="line"><span class="built_in">console</span>.log(r1.getName());</div><div class="line"><span class="comment">// and the same 'name' appears in r2 as well!</span></div><div class="line"><span class="built_in">console</span>.log(r2.getName());</div></pre></td></tr></table></figure>

<p>So it was easy. No? Great.</p>
<img class=" img" width="100" height="100" alt="Python" src="/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/java.png"></img>


<p>Now, Java. I know every one of you would already know it. I would write about it anyway, just for the sake of completeness. In Java, you create a private static instance of the class, and use that instance wherever necessary.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>{</div><div class="line">    <span class="comment">// static instance (Note: Resource instantiation is done here, not in getInstance)</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Resource instance = <span class="keyword">new</span> Resource();</div><div class="line">    <span class="comment">// property</span></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="comment">// private constructor to disable 'new'</span></div><div class="line">    <span class="keyword">private</span> <span class="title">Resource</span>() {</div><div class="line">    }</div><div class="line">    <span class="comment">// public staic method to get an instance of this class</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Resource <span class="title">getInstance</span>() {</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    }</div><div class="line">    <span class="comment">// getter</span></div><div class="line">    <span class="keyword">public</span> String <span class="title">getName</span>() {</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    }</div><div class="line">    <span class="comment">// setter</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(String name) {</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Now, let’s use it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">    <span class="comment">// get resource r1</span></div><div class="line">    Resource r1 = Resource.getInstance();</div><div class="line">    <span class="comment">// get resource r2  (since Resource is singleton, r1 == r2)</span></div><div class="line">    Resource r2 = Resource.getInstance();</div><div class="line">    <span class="comment">// to verify, let's set 'name' onto r1</span></div><div class="line">    r1.setName(<span class="string">"Animesh Kumar"</span>);</div><div class="line">    System.out.println(r1.getName());</div><div class="line">    <span class="comment">// and the same 'name' appears in r2 as well!</span></div><div class="line">    System.out.println(r2.getName());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Loud and clear. And this also stops you from instantiating ‘Resource‘ with ‘new‘ operator. Try this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Resource r1 = <span class="keyword">new</span> Resource();  <span class="comment">// java.lang.Error: Unresolved compilation problem:</span></div></pre></td></tr></table></figure>

<p>Your code will not compile. I know you know why. I will write anyways: because the constructor is private! So, there is no way to get an instance of Resource class but through ‘getInstance’ method which ensures single instance of the class. Also, If you noticed: I have instantiated ‘instance’ during declaration itself, not in ‘getInstance’ method. This way, the object gets created at the time of class loading, and you save yourself from a lot of issues that creeps in because of Java Just in Time.</p>
]]></content:encoded>
      <comments>http://47billion.com/blog/2015/02/04/fun-with-singleton-python-javascript-and-java/#disqus_comments</comments>
    </item>
    
    <item>
      <title><![CDATA[Jesque-Guice binding]]></title>
      <link>http://47billion.com/blog/2015/02/04/Jesque-Guice-binding/</link>
      <guid>http://47billion.com/blog/2015/02/04/Jesque-Guice-binding/</guid>
      <pubDate>Thu, 05 Feb 2015 06:59:00 GMT</pubDate>
      <description>
      <![CDATA[]]>
      </description>
      <content:encoded><![CDATA[]]></content:encoded>
      <comments>http://47billion.com/blog/2015/02/04/Jesque-Guice-binding/#disqus_comments</comments>
    </item>
    
    <item>
      <title><![CDATA[Delayed Jobs with Jesque]]></title>
      <link>http://47billion.com/blog/2015/02/04/Delayed-Jobs-with-Jesque/</link>
      <guid>http://47billion.com/blog/2015/02/04/Delayed-Jobs-with-Jesque/</guid>
      <pubDate>Thu, 05 Feb 2015 06:50:00 GMT</pubDate>
      <description>
      <![CDATA[]]>
      </description>
      <content:encoded><![CDATA[]]></content:encoded>
      <comments>http://47billion.com/blog/2015/02/04/Delayed-Jobs-with-Jesque/#disqus_comments</comments>
    </item>
    
    <item>
      <title><![CDATA[Hello World]]></title>
      <link>http://47billion.com/blog/2015/02/04/hello-world/</link>
      <guid>http://47billion.com/blog/2015/02/04/hello-world/</guid>
      <pubDate>Thu, 05 Feb 2015 06:15:52 GMT</pubDate>
      <description>
      <![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io]]>
      </description>
      <content:encoded><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">trobuleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2>
<h3 id="Create_a_new_post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content:encoded>
      <comments>http://47billion.com/blog/2015/02/04/hello-world/#disqus_comments</comments>
    </item>
    
  </channel>
</rss>